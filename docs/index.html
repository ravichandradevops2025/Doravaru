<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doravaru - Professional Trading Platform</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“Š</text></svg>">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary-bg: #0a0e1a;
            --secondary-bg: #1a1f2e;
            --card-bg: #252a3a;
            --accent-green: #00ff88;
            --accent-red: #ff4757;
            --accent-blue: #3742fa;
            --text-primary: #ffffff;
            --text-secondary: #a4a6b3;
            --border-color: #34384a;
        }
        
        body {
            font-family: 'Inter', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--primary-bg) 0%, #0f1419 100%);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .loading-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--primary-bg); display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 10000;
            opacity: 1; transition: opacity 0.5s ease;
        }
        .loading-overlay.hidden { opacity: 0; pointer-events: none; }
        .loading-spinner {
            width: 50px; height: 50px; border: 3px solid var(--border-color);
            border-top: 3px solid var(--accent-green); border-radius: 50%;
            animation: spin 1s linear infinite; margin-bottom: 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .navbar {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 30px; background: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
        }
        .nav-brand h1 {
            font-size: 24px; background: linear-gradient(135deg, var(--accent-green), var(--accent-blue));
            background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .nav-subtitle { font-size: 12px; color: var(--text-secondary); }
        .nav-status { display: flex; gap: 20px; align-items: center; }
        .status-indicator { display: flex; align-items: center; gap: 8px; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--accent-green); animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .market-time { font-weight: 600; color: var(--accent-green); }

        .platform-container {
            display: grid; grid-template-columns: 280px 1fr 300px;
            height: calc(100vh - 80px); gap: 1px; background: var(--border-color);
        }
        .sidebar, .right-panel { background: var(--secondary-bg); padding: 20px; overflow-y: auto; }
        .main-content { background: var(--secondary-bg); display: flex; flex-direction: column; overflow: hidden; }

        .symbol-card {
            padding: 12px; background: var(--card-bg); border-radius: 8px;
            cursor: pointer; transition: all 0.3s ease; border: 1px solid transparent;
            margin-bottom: 8px;
        }
        .symbol-card:hover { border-color: var(--accent-green); transform: translateX(2px); }
        .symbol-card.active { border-color: var(--accent-green); background: rgba(0, 255, 136, 0.05); }
        .symbol-name { font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; }
        .symbol-price { font-size: 16px; font-weight: 600; margin-bottom: 2px; }
        .symbol-change { font-size: 12px; font-weight: 500; }
        .symbol-change.positive { color: var(--accent-green); }
        .symbol-change.negative { color: var(--accent-red); }

        .chart-section { flex: 1; display: flex; flex-direction: column; padding: 20px; }
        .chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .chart-container { 
            flex: 1; background: var(--card-bg); border-radius: 8px; 
            padding: 20px; margin-bottom: 20px; position: relative;
        }
        #tradingChart { width: 100%; height: 100%; }

        .price-bar {
            display: flex; align-items: center; gap: 20px; padding: 15px 0;
            border-top: 1px solid var(--border-color);
        }
        .current-price { font-size: 24px; font-weight: 700; }
        .price-change { font-size: 14px; font-weight: 600; }
        .price-change.positive { color: var(--accent-green); }
        .price-change.negative { color: var(--accent-red); }

        .analysis-section {
            display: grid; grid-template-columns: 1fr 1fr; gap: 20px; padding: 0 20px 20px;
        }
        .technical-indicators, .signal-generator {
            background: var(--card-bg); padding: 20px; border-radius: 8px;
        }
        .indicators-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .indicator { display: flex; flex-direction: column; gap: 5px; }
        .indicator label { font-size: 12px; color: var(--text-secondary); }
        .indicator span { font-weight: 600; }
        .indicator .bullish { color: var(--accent-green); }
        .indicator .bearish { color: var(--accent-red); }
        .indicator .neutral { color: #ffd700; }

        .generate-btn {
            width: 100%; padding: 15px; background: linear-gradient(135deg, var(--accent-green), var(--accent-blue));
            color: white; border: none; border-radius: 8px; font-size: 14px;
            font-weight: 600; cursor: pointer; transition: transform 0.3s ease;
        }
        .generate-btn:hover { transform: translateY(-2px); }
        .generate-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }

        .signal-result { margin-top: 20px; }
        .professional-signal {
            background: var(--card-bg); border-radius: 12px; padding: 20px;
            border: 1px solid var(--border-color);
        }

        .depth-table {
            background: var(--card-bg); border-radius: 8px; overflow: hidden; margin-bottom: 30px;
        }
        .depth-header {
            display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px;
            padding: 10px; background: var(--primary-bg); font-size: 12px;
            font-weight: 600; color: var(--text-secondary);
        }
        .depth-row {
            display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 10px;
            padding: 8px 10px; font-size: 12px; border-bottom: 1px solid var(--border-color);
        }

        .news-item {
            padding: 15px; background: var(--card-bg); border-radius: 8px;
            position: relative; margin-bottom: 15px;
        }
        .news-time {
            font-size: 10px; color: var(--text-secondary);
            position: absolute; top: 8px; right: 8px;
        }
        .sentiment {
            font-size: 10px; padding: 2px 6px; border-radius: 4px; font-weight: 600;
        }
        .sentiment.bullish { background: rgba(0, 255, 136, 0.2); color: var(--accent-green); }
        .sentiment.bearish { background: rgba(255, 71, 87, 0.2); color: var(--accent-red); }
        .sentiment.neutral { background: rgba(255, 215, 0, 0.2); color: #ffd700; }

        .portfolio-metrics { display: flex; flex-direction: column; gap: 12px; }
        .metric { display: flex; justify-content: space-between; align-items: center; }
        .metric label { font-size: 12px; color: var(--text-secondary); }
        .metric .value { font-weight: 600; }
        .metric .value.positive { color: var(--accent-green); }
        .metric .value.negative { color: var(--accent-red); }

        @media (max-width: 1200px) {
            .platform-container { grid-template-columns: 250px 1fr 250px; }
            .analysis-section { grid-template-columns: 1fr; }
        }
        @media (max-width: 768px) {
            .platform-container { grid-template-columns: 1fr; grid-template-rows: auto 1fr auto; }
            .sidebar, .right-panel { height: auto; }
        }
    </style>
</head>
<body>
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <p>Loading Professional Trading Platform...</p>
    </div>

    <nav class="navbar">
        <div class="nav-brand">
            <h1>Doravaru</h1>
            <span class="nav-subtitle">Professional Trading Platform</span>
        </div>
        <div class="nav-status">
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span>Market Data Connected</span>
            </div>
            <div class="market-time" id="market-time">NSE: OPEN</div>
        </div>
    </nav>

    <div class="platform-container">
        <aside class="sidebar">
            <div class="watchlist-section">
                <h3>Watchlist</h3>
                <div id="watchlist">
                    <div class="symbol-card active" data-symbol="NIFTY">
                        <div class="symbol-name">NIFTY 50</div>
                        <div class="symbol-price" id="price-NIFTY">25,420.45</div>
                        <div class="symbol-change positive" id="change-NIFTY">+0.85%</div>
                    </div>
                    <div class="symbol-card" data-symbol="BANKNIFTY">
                        <div class="symbol-name">BANK NIFTY</div>
                        <div class="symbol-price" id="price-BANKNIFTY">55,715.15</div>
                        <div class="symbol-change positive" id="change-BANKNIFTY">+1.12%</div>
                    </div>
                    <div class="symbol-card" data-symbol="RELIANCE">
                        <div class="symbol-name">RELIANCE</div>
                        <div class="symbol-price" id="price-RELIANCE">1,424.00</div>
                        <div class="symbol-change negative" id="change-RELIANCE">-0.45%</div>
                    </div>
                    <div class="symbol-card" data-symbol="TCS">
                        <div class="symbol-name">TCS</div>
                        <div class="symbol-price" id="price-TCS">4,087.30</div>
                        <div class="symbol-change positive" id="change-TCS">+2.15%</div>
                    </div>
                </div>
            </div>

            <div class="portfolio-summary">
                <h3>Portfolio</h3>
                <div class="portfolio-metrics">
                    <div class="metric">
                        <label>Total Value</label>
                        <span class="value">â‚¹1,00,000</span>
                    </div>
                    <div class="metric">
                        <label>P&L Today</label>
                        <span class="value positive">+â‚¹2,450</span>
                    </div>
                    <div class="metric">
                        <label>Available Margin</label>
                        <span class="value">â‚¹97,550</span>
                    </div>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <div class="chart-section">
                <div class="chart-header">
                    <h2 id="chart-title">NIFTY 50 - Live Chart</h2>
                </div>
                <div class="chart-container">
                    <canvas id="tradingChart" width="800" height="400"></canvas>
                </div>
                <div class="price-bar">
                    <div class="current-price" id="currentPrice">25,420.45</div>
                    <div class="price-change positive" id="priceChange">+215.75 (+0.85%)</div>
                    <div class="volume">Volume: <span id="volume">2.1M</span></div>
                </div>
            </div>

            <div class="analysis-section">
                <div class="technical-indicators">
                    <h3>Technical Analysis</h3>
                    <div class="indicators-grid">
                        <div class="indicator">
                            <label>RSI (14)</label>
                            <span id="rsi" class="neutral">58.4</span>
                        </div>
                        <div class="indicator">
                            <label>MACD</label>
                            <span id="macd" class="bullish">Bullish</span>
                        </div>
                        <div class="indicator">
                            <label>SMA 20</label>
                            <span id="sma20">25,185.30</span>
                        </div>
                        <div class="indicator">
                            <label>Support</label>
                            <span id="support">25,250.00</span>
                        </div>
                        <div class="indicator">
                            <label>Resistance</label>
                            <span id="resistance">25,580.00</span>
                        </div>
                    </div>
                </div>

                <div class="signal-generator">
                    <h3>AI Trading Signals & Options</h3>
                    <button id="generateSignal" class="generate-btn">Generate Advanced Signal</button>
                    <div id="signalResult" class="signal-result"></div>
                </div>
            </div>
        </main>

        <aside class="right-panel">
            <div class="market-depth">
                <h3>Market Depth</h3>
                <div class="depth-table">
                    <div class="depth-header">
                        <span>Bid Qty</span>
                        <span>Bid</span>
                        <span>Ask</span>
                        <span>Ask Qty</span>
                    </div>
                    <div id="marketDepth"></div>
                </div>
            </div>

            <div class="news-feed">
                <h3>Market News</h3>
                <div class="news-items">
                    <div class="news-item">
                        <span class="news-time">10:45</span>
                        <p>FII net buying â‚¹2,450 crores in cash segment</p>
                        <span class="sentiment bullish">Bullish</span>
                    </div>
                    <div class="news-item">
                        <span class="news-time">10:30</span>
                        <p>Banking index shows strong momentum</p>
                        <span class="sentiment bullish">Bullish</span>
                    </div>
                    <div class="news-item">
                        <span class="news-time">10:15</span>
                        <p>Global markets mixed on Fed concerns</p>
                        <span class="sentiment neutral">Neutral</span>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <script>
        // Professional Trading Platform - Complete Implementation
        class TradingPlatform {
            constructor() {
                this.symbols = {
                    'NIFTY': 25420.45,
                    'BANKNIFTY': 55715.15,
                    'RELIANCE': 1424.00,
                    'TCS': 4087.30
                };
                this.marketData = new Map();
                this.currentSymbol = 'NIFTY';
                this.chartCanvas = null;
                this.chartCtx = null;
                this.init();
            }

            async init() {
                // Hide loading after 2 seconds
                setTimeout(() => {
                    document.getElementById('loadingOverlay').classList.add('hidden');
                }, 2000);

                // Initialize market data
                Object.keys(this.symbols).forEach(symbol => {
                    this.generateMarketData(symbol);
                });

                // Setup chart
                this.initChart();
                
                // Setup event listeners
                this.setupEventListeners();
                
                // Update displays
                this.updateAllDisplays();
                
                // Start real-time updates
                this.startRealTimeUpdates();
                this.updateMarketTime();
                setInterval(() => this.updateMarketTime(), 1000);
            }

            generateMarketData(symbol) {
                const basePrice = this.symbols[symbol];
                const data = [];
                let price = basePrice;

                for (let i = 100; i >= 0; i--) {
                    const timestamp = new Date(Date.now() - i * 60000);
                    const volatility = 0.001;
                    const change = (Math.random() - 0.5) * volatility;
                    price = Math.max(price * (1 + change), basePrice * 0.985);
                    
                    const open = price;
                    const high = price * (1 + Math.random() * volatility);
                    const low = price * (1 - Math.random() * volatility);
                    const close = low + Math.random() * (high - low);
                    
                    data.push({
                        timestamp: timestamp.toISOString(),
                        open: parseFloat(open.toFixed(2)),
                        high: parseFloat(high.toFixed(2)),
                        low: parseFloat(low.toFixed(2)),
                        close: parseFloat(close.toFixed(2)),
                        volume: Math.floor(Math.random() * 500000) + 100000
                    });
                    
                    price = close;
                }
                
                this.marketData.set(symbol, data);
            }

            initChart() {
                this.chartCanvas = document.getElementById('tradingChart');
                this.chartCtx = this.chartCanvas.getContext('2d');
                this.renderChart();
            }

            renderChart() {
                const data = this.marketData.get(this.currentSymbol);
                if (!data) return;

                const ctx = this.chartCtx;
                const canvas = this.chartCanvas;
                
                // Clear canvas
                ctx.fillStyle = '#252a3a';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                const padding = { top: 20, right: 60, bottom: 40, left: 60 };
                const chartWidth = canvas.width - padding.left - padding.right;
                const chartHeight = canvas.height - padding.top - padding.bottom;

                const prices = data.slice(-50).flatMap(d => [d.high, d.low]);
                const minPrice = Math.min(...prices) * 0.999;
                const maxPrice = Math.max(...prices) * 1.001;
                const priceRange = maxPrice - minPrice;

                const candleWidth = chartWidth / 50 * 0.8;
                const candleSpacing = chartWidth / 50;

                // Draw candles
                data.slice(-50).forEach((candle, index) => {
                    const x = padding.left + (candleSpacing * index);
                    const isGreen = candle.close >= candle.open;
                    
                    const openY = padding.top + chartHeight - ((candle.open - minPrice) / priceRange) * chartHeight;
                    const closeY = padding.top + chartHeight - ((candle.close - minPrice) / priceRange) * chartHeight;
                    const highY = padding.top + chartHeight - ((candle.high - minPrice) / priceRange) * chartHeight;
                    const lowY = padding.top + chartHeight - ((candle.low - minPrice) / priceRange) * chartHeight;
                    
                    // Draw wick
                    ctx.strokeStyle = isGreen ? '#00ff88' : '#ff4757';
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(x + candleWidth / 2, highY);
                    ctx.lineTo(x + candleWidth / 2, lowY);
                    ctx.stroke();
                    
                    // Draw body
                    ctx.fillStyle = isGreen ? '#00ff88' : '#ff4757';
                    const bodyHeight = Math.abs(closeY - openY) || 2;
                    const bodyY = Math.min(openY, closeY);
                    ctx.fillRect(x, bodyY, candleWidth, bodyHeight);
                });
            }

            setupEventListeners() {
                // Symbol selection
                document.querySelectorAll('.symbol-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const symbol = card.dataset.symbol;
                        this.selectSymbol(symbol);
                    });
                });

                // Signal generation
                document.getElementById('generateSignal').addEventListener('click', () => {
                    this.generateAdvancedSignal();
                });
            }

            selectSymbol(symbol) {
                this.currentSymbol = symbol;
                
                document.querySelectorAll('.symbol-card').forEach(card => {
                    card.classList.remove('active');
                    if (card.dataset.symbol === symbol) {
                        card.classList.add('active');
                    }
                });
                
                this.updateAllDisplays();
            }

            updateAllDisplays() {
                this.renderChart();
                this.updatePriceDisplay();
                this.updateTechnicalIndicators();
                this.updateMarketDepth();
            }

            updatePriceDisplay() {
                const data = this.marketData.get(this.currentSymbol);
                if (!data || data.length === 0) return;

                const current = data[data.length - 1];
                const previous = data[data.length - 2];
                
                const change = current.close - previous.close;
                const changePercent = (change / previous.close) * 100;
                
                document.getElementById('chart-title').textContent = `${this.currentSymbol} - Live Chart`;
                document.getElementById('currentPrice').textContent = current.close.toLocaleString();
                
                const priceChangeEl = document.getElementById('priceChange');
                const sign = change >= 0 ? '+' : '';
                priceChangeEl.textContent = `${sign}${change.toFixed(2)} (${sign}${changePercent.toFixed(2)}%)`;
                priceChangeEl.className = `price-change ${change >= 0 ? 'positive' : 'negative'}`;
                
                document.getElementById('volume').textContent = (current.volume / 1000000).toFixed(1) + 'M';
            }

            updateTechnicalIndicators() {
                const data = this.marketData.get(this.currentSymbol);
                if (!data) return;

                const closes = data.map(d => d.close);
                const rsi = this.calculateRSI(closes);
                const sma20 = this.calculateSMA(closes, 20);
                
                const rsiEl = document.getElementById('rsi');
                rsiEl.textContent = rsi.toFixed(1);
                rsiEl.className = rsi > 70 ? 'bearish' : rsi < 30 ? 'bullish' : 'neutral';

                document.getElementById('sma20').textContent = sma20.toFixed(2);
                document.getElementById('support').textContent = (sma20 * 0.985).toFixed(2);
                document.getElementById('resistance').textContent = (sma20 * 1.015).toFixed(2);
            }

            calculateRSI(prices, period = 14) {
                if (prices.length < period + 1) return 50;
                
                const gains = [], losses = [];
                for (let i = 1; i < prices.length; i++) {
                    const change = prices[i] - prices[i - 1];
                    gains.push(change > 0 ? change : 0);
                    losses.push(change < 0 ? Math.abs(change) : 0);
                }
                
                const avgGain = gains.slice(-period).reduce((a, b) => a + b, 0) / period;
                const avgLoss = losses.slice(-period).reduce((a, b) => a + b, 0) / period;
                
                return avgLoss === 0 ? 100 : 100 - (100 / (1 + avgGain / avgLoss));
            }

            calculateSMA(prices, period) {
                if (prices.length < period) return prices[prices.length - 1];
                return prices.slice(-period).reduce((a, b) => a + b, 0) / period;
            }

            updateMarketDepth() {
                const data = this.marketData.get(this.currentSymbol);
                if (!data) return;

                const currentPrice = data[data.length - 1].close;
                const spread = currentPrice * 0.0002;
                
                let depthHtml = '';
                for (let i = 0; i < 5; i++) {
                    const bid = (currentPrice - (spread * (i + 1))).toFixed(2);
                    const ask = (currentPrice + (spread * (i + 1))).toFixed(2);
                    const bidQty = (Math.floor(Math.random() * 5000) + 1000).toLocaleString();
                    const askQty = (Math.floor(Math.random() * 5000) + 1000).toLocaleString();
                    
                    depthHtml += `
                        <div class="depth-row">
                            <span style="color: #00ff88">${bidQty}</span>
                            <span style="color: #00ff88">${bid}</span>
                            <span style="color: #ff4757">${ask}</span>
                            <span style="color: #ff4757">${askQty}</span>
                        </div>
                    `;
                }
                
                document.getElementById('marketDepth').innerHTML = depthHtml;
            }

            async generateAdvancedSignal() {
                const btn = document.getElementById('generateSignal');
                const originalText = btn.textContent;
                
                btn.textContent = 'Analyzing Market...';
                btn.disabled = true;
                
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                const data = this.marketData.get(this.currentSymbol);
                const closes = data.map(d => d.close);
                const currentPrice = closes[closes.length - 1];
                const rsi = this.calculateRSI(closes);
                const sma20 = this.calculateSMA(closes, 20);
                
                let signal = 'HOLD', confidence = 65;
                if (currentPrice > sma20 && rsi < 70) {
                    signal = 'BUY';
                    confidence = 78;
                } else if (currentPrice < sma20 && rsi > 30) {
                    signal = 'SELL';
                    confidence = 73;
                }

                const entry = signal === 'BUY' ? currentPrice * 1.002 : currentPrice * 0.998;
                const stopLoss = signal === 'BUY' ? currentPrice * 0.985 : currentPrice * 1.015;
                const target1 = signal === 'BUY' ? currentPrice * 1.025 : currentPrice * 0.975;
                
                const signalColor = signal === 'BUY' ? '#00ff88' : signal === 'SELL' ? '#ff4757' : '#ffd700';
                
                // Generate options recommendation
                const optionsRec = this.generateOptionsRecommendation(signal, currentPrice);
                
                document.getElementById('signalResult').innerHTML = `
                    <div class="professional-signal">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                            <h4 style="color: ${signalColor};">${this.currentSymbol} - ${signal} Signal</h4>
                            <span style="color: ${signalColor}; font-size: 18px; font-weight: bold;">${confidence}%</span>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin: 20px 0;">
                            <div style="text-align: center; padding: 15px; background: rgba(0,255,136,0.1); border-radius: 8px;">
                                <div style="color: #888; font-size: 12px;">Entry</div>
                                <div style="font-size: 16px; font-weight: bold; color: #00ff88;">â‚¹${entry.toFixed(2)}</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: rgba(76,175,80,0.1); border-radius: 8px;">
                                <div style="color: #888; font-size: 12px;">Target 1</div>
                                <div style="font-size: 16px; font-weight: bold; color: #4caf50;">â‚¹${target1.toFixed(2)}</div>
                            </div>
                        </div>
                        
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin: 20px 0;">
                            <h4 style="margin-bottom: 10px;">Options Strategy Recommendation:</h4>
                            ${optionsRec}
                        </div>
                        
                        <div style="background: rgba(0,255,136,0.1); padding: 15px; border-radius: 8px;">
                            <h4 style="margin-bottom: 10px;">Technical Analysis:</h4>
                            <ul style="margin-left: 15px; font-size: 12px; color: #a4a6b3;">
                                <li>RSI: ${rsi.toFixed(1)} - ${rsi > 70 ? 'Overbought' : rsi < 30 ? 'Oversold' : 'Neutral'}</li>
                                <li>Price vs SMA20: ${currentPrice > sma20 ? 'Above (Bullish)' : 'Below (Bearish)'}</li>
                                <li>Confidence based on multiple technical indicators</li>
                                <li>Risk management levels calculated using volatility analysis</li>
                            </ul>
                        </div>
                    </div>
                `;
                
                // Draw chart annotations
                this.drawChartAnnotations(entry, stopLoss, target1, signal);
                
                btn.textContent = originalText;
                btn.disabled = false;
            }

            generateOptionsRecommendation(signal, currentPrice) {
                const atmStrike = Math.round(currentPrice / 50) * 50;
                
                if (signal === 'BUY') {
                    const callPremium = (currentPrice * 0.02).toFixed(2);
                    return `
                        <div style="background: rgba(0,255,136,0.1); padding: 12px; border-radius: 6px;">
                            <strong style="color: #00ff88;">Long Call Strategy</strong><br>
                            <span style="font-size: 12px;">BUY ${this.currentSymbol} ${atmStrike} CALL @ â‚¹${callPremium}</span><br>
                            <span style="font-size: 11px; color: #a4a6b3;">Max Loss: â‚¹${callPremium} | Breakeven: â‚¹${(atmStrike + parseFloat(callPremium)).toFixed(2)}</span>
                        </div>
                    `;
                } else if (signal === 'SELL') {
                    const putPremium = (currentPrice * 0.018).toFixed(2);
                    return `
                        <div style="background: rgba(255,71,87,0.1); padding: 12px; border-radius: 6px;">
                            <strong style="color: #ff4757;">Long Put Strategy</strong><br>
                            <span style="font-size: 12px;">BUY ${this.currentSymbol} ${atmStrike} PUT @ â‚¹${putPremium}</span><br>
                            <span style="font-size: 11px; color: #a4a6b3;">Max Loss: â‚¹${putPremium} | Breakeven: â‚¹${(atmStrike - parseFloat(putPremium)).toFixed(2)}</span>
                        </div>
                    `;
                } else {
                    return `
                        <div style="background: rgba(255,215,0,0.1); padding: 12px; border-radius: 6px;">
                            <strong style="color: #ffd700;">Iron Condor Strategy</strong><br>
                            <span style="font-size: 12px;">Range-bound strategy recommended</span><br>
                            <span style="font-size: 11px; color: #a4a6b3;">Neutral outlook - collect premium from time decay</span>
                        </div>
                    `;
                }
            }

            drawChartAnnotations(entry, stopLoss, target, signal) {
                const ctx = this.chartCtx;
                const canvas = this.chartCanvas;
                
                // Re-render chart first
                this.renderChart();
                
                const padding = { top: 20, right: 60, bottom: 40, left: 60 };
                const chartWidth = canvas.width - padding.left - padding.right;
                const chartHeight = canvas.height - padding.top - padding.bottom;
                
                const data = this.marketData.get(this.currentSymbol);
                const prices = data.slice(-50).flatMap(d => [d.high, d.low]);
                const minPrice = Math.min(...prices) * 0.999;
                const maxPrice = Math.max(...prices) * 1.001;
                const priceRange = maxPrice - minPrice;
                
                // Helper function to convert price to Y coordinate
                const priceToY = (price) => {
                    return padding.top + chartHeight - ((price - minPrice) / priceRange) * chartHeight;
                };
                
                // Draw horizontal lines with labels
                const drawLine = (price, color, label, lineWidth = 2) => {
                    const y = priceToY(price);
                    
                    ctx.strokeStyle = color;
                    ctx.lineWidth = lineWidth;
                    ctx.setLineDash([5, 5]);
                    
                    ctx.beginPath();
                    ctx.moveTo(padding.left, y);
                    ctx.lineTo(padding.left + chartWidth, y);
                    ctx.stroke();
                    ctx.setLineDash([]);
                    
                    // Draw label
                    ctx.fillStyle = color;
                    ctx.font = '12px Inter';
                    ctx.textAlign = 'left';
                    ctx.fillText(label, padding.left + 10, y - 5);
                };
                
                // Draw signal lines
                drawLine(entry, '#00ff88', `ENTRY: â‚¹${entry.toFixed(2)}`, 2);
                drawLine(stopLoss, '#ff4757', `STOP LOSS: â‚¹${stopLoss.toFixed(2)}`, 2);
                drawLine(target, '#4caf50', `TARGET: â‚¹${target.toFixed(2)}`, 1);
                
                // Draw signal arrow
                const currentPrice = data[data.length - 1].close;
                const arrowY = priceToY(currentPrice);
                const arrowX = padding.left + chartWidth - 50;
                
                ctx.fillStyle = signal === 'BUY' ? '#00ff88' : '#ff4757';
                ctx.strokeStyle = signal === 'BUY' ? '#00ff88' : '#ff4757';
                ctx.lineWidth = 2;
                
                if (signal === 'BUY') {
                    // Up arrow
                    ctx.beginPath();
                    ctx.moveTo(arrowX, arrowY);
                    ctx.lineTo(arrowX - 8, arrowY + 15);
                    ctx.lineTo(arrowX + 8, arrowY + 15);
                    ctx.closePath();
                    ctx.fill();
                } else if (signal === 'SELL') {
                    // Down arrow
                    ctx.beginPath();
                    ctx.moveTo(arrowX, arrowY);
                    ctx.lineTo(arrowX - 8, arrowY - 15);
                    ctx.lineTo(arrowX + 8, arrowY - 15);
                    ctx.closePath();
                    ctx.fill();
                }
            }

            startRealTimeUpdates() {
                setInterval(() => {
                    // Update prices for all symbols
                    Object.keys(this.symbols).forEach(symbol => {
                        const data = this.marketData.get(symbol);
                        if (data && data.length > 0) {
                            const lastCandle = data[data.length - 1];
                            const basePrice = this.symbols[symbol];
                            const volatility = 0.0008;
                            const change = (Math.random() - 0.5) * volatility;
                            const newPrice = Math.max(lastCandle.close * (1 + change), basePrice * 0.98);
                            
                            const newCandle = {
                                timestamp: new Date().toISOString(),
                                open: newPrice * (1 + (Math.random() - 0.5) * 0.001),
                                high: newPrice * (1 + Math.random() * 0.002),
                                low: newPrice * (1 - Math.random() * 0.002),
                                close: newPrice,
                                volume: Math.floor(Math.random() * 100000) + 50000
                            };
                            
                            data.push(newCandle);
                            if (data.length > 200) data.shift();
                            
                            // Update symbol price in watchlist
                            const priceEl = document.getElementById(`price-${symbol}`);
                            const changeEl = document.getElementById(`change-${symbol}`);
                            
                            if (priceEl && changeEl) {
                                const prevPrice = data[data.length - 2].close;
                                const changePercent = ((newPrice - prevPrice) / prevPrice) * 100;
                                
                                priceEl.textContent = newPrice.toLocaleString('en-IN');
                                const sign = changePercent >= 0 ? '+' : '';
                                changeEl.textContent = `${sign}${changePercent.toFixed(2)}%`;
                                changeEl.className = `symbol-change ${changePercent >= 0 ? 'positive' : 'negative'}`;
                            }
                        }
                    });
                    
                    // Update current symbol display
                    if (this.currentSymbol) {
                        this.updateAllDisplays();
                    }
                }, 5000);
            }

            updateMarketTime() {
                const now = new Date();
                const hour = now.getHours();
                const minute = now.getMinutes();
                const isMarketOpen = (hour >= 9 && hour < 15) || (hour === 15 && minute < 30);
                
                const timeStr = now.toLocaleTimeString('en-IN', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                
                document.getElementById('market-time').textContent = 
                    `NSE: ${isMarketOpen ? 'OPEN' : 'CLOSED'} | ${timeStr}`;
            }
        }

        // Initialize the trading platform
        document.addEventListener('DOMContentLoaded', () => {
            new TradingPlatform();
        });
    </script>
</body>
</html>